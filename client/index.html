<html>
<head>
	<title>Netgraph</title>
	<script type="text/javascript" src="jquery-1.8.0.js"></script>

	<!--[if lt IE 9]><script language="javascript" type="text/javascript" src="jqplot/excanvas.js"></script><![endif]-->
	<script language="javascript" type="text/javascript" src="jqplot/jquery.jqplot.js"></script>
	<script type="text/javascript" language="javascript" src="jqplot/plugins/jqplot.dateAxisRenderer.js"></script>
	<link rel="stylesheet" type="text/css" href="jqplot/jquery.jqplot.css" />

</head>
<body>
	<h1>Netgraph</h1>
	<div id="netgraph-graph" style="width: 100%; height: 400px; background: #eee;"></div>
	<div id="netgraph-console" style="width: 100%; min-height: 1em; background: #eee;"></div>

	<script type="text/javascript">
	$.jqplot.config.enablePlugins = true;
	var plot = $.jqplot('netgraph-graph',
		[[[new Date(), 0]]],
		{axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer}}}
		);
	var previousData = {};
	function updateGraph()
	{
		$.ajax(
			{
				url: "../server/",
			}).done(function (data)
			{
				var newData = {INPUT: data.chains.INPUT.bytes};
				
				// convert to difference from previous value
				for (var chain in newData)
				{
					if (!newData.hasOwnProperty(chain)) continue;
					
					if (chain in previousData)
					{
						newData[chain] -= previousData[chain];
					}
					else
					{
						newData[chain] = 0;
					}
					
					previousData[chain] = newData[chain];
				}
				
				plot.data[0].push([new Date(), newData.INPUT]);
				plot.replot({data: plot.data, resetAxes: true});
			});
	}
	setInterval(updateGraph, 1000);
	</script>

</body>
</html>
	
